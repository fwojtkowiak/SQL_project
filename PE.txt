--poprawione dzieci

alter function dzieci_pe5
		(@numer varchar(50))
returns table
as 
return select * from projekt_pe as s where s.sciezka = @numer or s.Sciezka like @numer+'/%' or s.Sciezka like '%/'+@numer+'/%'

--usuwanie komentarza(z wszystkimi dziecmi)
create procedure USUN_KOMENTARZ_PE1
	@numer_komentarza varchar(50)
AS
	begin try
		if exists (select * from projekt_pe where numer=@numer_komentarza)
	begin
		delete from projekt_pe where Sciezka = @numer_komentarza or Sciezka like @numer_komentarza+'/%'
		
	 end
	 else
        raiserror ('Nie ma takiego komentarza', 11,1)
end try
begin catch
                SELECT ERROR_NUMBER() AS 'NUMER BLEDU',ERROR_MESSAGE() AS 'KOMUNIKAT'
end catch


--znajdowanie ojca DO POPRAWY, NIE DZIALA DLA PIERWSZEGO POZIOMU
create function RODZIC_PE5
	(@numer_komentarza varchar(50))
returns table
AS
return

select numer from projekt_pe where sciezka=(select SUBSTRING(sciezka, 1, LEN(sciezka)-LEN(@numer_komentarza)-1)  from projekt_pe where numer=@numer_komentarza)

create function OsobyNaStanowisku2
        (@s varchar(20))
        returns @nazwiska table
                (nazwisko varchar(20))
as
begin
        if @s in ('profesor', 'adiunkt', 'doktorant', 'sekretarka', 'techniczny')
                insert into @nazwiska
                select nazwisko from pracownicy where stanowisko = @s
        else
                insert into @nazwiska
                select nazwisko from pracownicy
return
end


select * from projekt_pe select * from projekt_al

create function RODZIC_PE5
	(@numer_komentarza varchar(50))
returns table
AS
return

select numer from projekt_pe where sciezka=(select SUBSTRING(sciezka, 1, LEN(sciezka)-LEN(@numer_komentarza)-1)  from projekt_pe where numer=@numer_komentarza)